{% extends "base.html" %}

{% block title %}ê´€ë¦¬ì - WeTube{% endblock %}

{% block content %}
  <div class="admin-page">
    <div class="admin-header">
      <h1 class="admin-title">ê´€ë¦¬ì</h1>
      <div class="admin-header-actions">
        <a href="{{ url_for('admin.users') }}" class="btn btn--outline btn--small">ì‚¬ìš©ì ì „ì²´</a>
        <a href="{{ url_for('admin.videos') }}" class="btn btn--outline btn--small">ë™ì˜ìƒ ì „ì²´</a>
        <a href="{{ url_for('admin.comments') }}" class="btn btn--outline btn--small">ëŒ“ê¸€ ì „ì²´</a>
        <a href="{{ url_for('auth.logout') }}" class="btn btn--outline">ë¡œê·¸ì•„ì›ƒ</a>
      </div>
    </div>

    <div class="admin-content">
      <!-- í†µê³„ -->
      <div class="admin-stats">
        <div class="admin-stat-card">
          <span class="stat-value">{{ stats.user_count|default(0) }}</span>
          <span class="stat-label">ì‚¬ìš©ì</span>
        </div>
        <div class="admin-stat-card">
          <span class="stat-value">{{ stats.video_count|default(0) }}</span>
          <span class="stat-label">ë™ì˜ìƒ</span>
        </div>
        <div class="admin-stat-card">
          <span class="stat-value">{{ stats.comment_count|default(0) }}</span>
          <span class="stat-label">ëŒ“ê¸€</span>
        </div>
      </div>

      <!-- ì‚¬ìš©ì ëª©ë¡ -->
      <section class="admin-section">
        <h2 class="admin-section-title">ì‚¬ìš©ì ëª©ë¡ <a href="{{ url_for('admin.users') }}" class="admin-more">ì „ì²´ ë³´ê¸°</a></h2>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ì•„ì´ë””</th>
                <th>ì´ë©”ì¼</th>
                <th>ë‹‰ë„¤ì„</th>
                <th>ê´€ë¦¬ì</th>
                <th>ê°€ì…ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody>
              {% for u in users_list %}
              <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ u.email }}</td>
                <td>{{ u.nickname or '-' }}</td>
                <td>{% if u.is_admin %}ì˜ˆ{% else %}ì•„ë‹ˆì˜¤{% endif %}</td>
                <td>{{ u.created_at.strftime('%Y-%m-%d') if u.created_at else '-' }}</td>
                <td>
                  <a href="{{ url_for('admin.user_edit', user_id=u.id) }}" class="btn-icon" title="ìˆ˜ì •">âœï¸</a>
                  {% if u.id != current_user.id %}
                  <form method="post" action="{{ url_for('admin.user_delete', user_id=u.id) }}" class="admin-delete-form" style="display:inline;" onsubmit="return confirm('ì´ íšŒì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <button type="submit" class="btn-icon btn-icon--danger" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                  </form>
                  {% endif %}
                </td>
              </tr>
              {% else %}
              <tr><td colspan="7" class="admin-empty">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- ë™ì˜ìƒ ëª©ë¡ -->
      <section class="admin-section">
        <h2 class="admin-section-title">ë™ì˜ìƒ ëª©ë¡ <a href="{{ url_for('admin.videos') }}" class="admin-more">ì „ì²´ ë³´ê¸°</a></h2>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ì œëª©</th>
                <th>ì—…ë¡œë”</th>
                <th>ì¡°íšŒìˆ˜</th>
                <th>ì—…ë¡œë“œì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody>
              {% for v in videos_list %}
              <tr>
                <td>{{ v.id }}</td>
                <td><a href="{{ url_for('main.watch', video_id=v.id) }}">{{ v.title[:40] }}{% if v.title|length > 40 %}...{% endif %}</a></td>
                <td>{{ v.user.username if v.user else '-' }}</td>
                <td>{{ v.views }}</td>
                <td>{{ v.created_at.strftime('%Y-%m-%d') if v.created_at else '-' }}</td>
                <td>
                  <form method="post" action="{{ url_for('admin.video_delete', video_id=v.id) }}" class="admin-delete-form" style="display:inline;" onsubmit="return confirm('ì´ ë™ì˜ìƒì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <button type="submit" class="btn-icon btn-icon--danger" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr><td colspan="6" class="admin-empty">ë“±ë¡ëœ ë™ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>

      <!-- ëŒ“ê¸€ ëª©ë¡ -->
      <section class="admin-section">
        <h2 class="admin-section-title">ëŒ“ê¸€ ëª©ë¡ <a href="{{ url_for('admin.comments') }}" class="admin-more">ì „ì²´ ë³´ê¸°</a></h2>
        <div class="admin-table-wrap">
          <table class="admin-table">
            <thead>
              <tr>
                <th>#</th>
                <th>ë‚´ìš©</th>
                <th>ì‘ì„±ì</th>
                <th>ë™ì˜ìƒ</th>
                <th>ì‘ì„±ì¼</th>
                <th>ê´€ë¦¬</th>
              </tr>
            </thead>
            <tbody>
              {% for c in comments_list %}
              <tr>
                <td>{{ c.id }}</td>
                <td class="col-content">{{ (c.content or '')[:50] }}{% if (c.content or '')|length > 50 %}...{% endif %}</td>
                <td>{{ c.user.username if c.user else '-' }}</td>
                <td>{{ c.video.title[:20] if c.video and c.video.title else '-' }}{% if c.video and c.video.title and c.video.title|length > 20 %}...{% endif %}</td>
                <td>{{ c.created_at.strftime('%Y-%m-%d %H:%M') if c.created_at else '-' }}</td>
                <td>
                  <form method="post" action="{{ url_for('admin.comment_delete', comment_id=c.id) }}" class="admin-delete-form" style="display:inline;" onsubmit="return confirm('ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                    <input type="hidden" name="next" value="index">
                    <button type="submit" class="btn-icon btn-icon--danger" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                  </form>
                </td>
              </tr>
              {% else %}
              <tr><td colspan="6" class="admin-empty">ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </section>
    </div>
  </div>
{% endblock %}
